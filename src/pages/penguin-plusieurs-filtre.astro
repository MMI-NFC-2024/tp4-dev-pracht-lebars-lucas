---
import PlotFigure from "../components/PlotFigure.astro";
import Layout from "../layouts/Layout.astro";
import * as Plot from "@observablehq/plot";
import penguins from "../assets/penguins.json";
---

<Layout>

    <h1 class="text-2xl">Filtre Penguins</h1>
    
    <label for="species">Filtrer par espèce :</label>
    <select name="species" id="species">
        <option value="">All species</option>
        <option value="Adelie">Adelie</option>
        <option value="Chinstrap">Chinstrap</option>
        <option value="Gentoo">Gentoo</option>
    </select>
    
    <label for="island">Filtrer par île :</label>
    <select name="island" id="island">
        <option value="">All islands</option>
        <option value="Biscoe">Biscoe</option>
        <option value="Dream">Dream</option>
        <option value="Torgersen">Torgersen</option>
    </select>
    
    <label for="sex">Filtrer par sexe :</label>
    <select name="sex" id="sex">
        <option value="">All sexes</option>
        <option value="MALE">MALE</option>
        <option value="FEMALE">FEMALE</option>
    </select>
    
    <div id="myplot"></div>
<script>
  // Importe la librairie Plot d'ObservableHQ
  import * as Plot from "@observablehq/plot";
  // Importe les données des manchots depuis un fichier JSON
  import penguins from "../assets/penguins.json";

  // Récupère les éléments select
  const selectSpecies = document.querySelector("#species");
  const selectIsland = document.querySelector("#island");
  const selectSex = document.querySelector("#sex");

  // Fonction pour afficher le graphique
  function renderPlot() {
    // Récupère les valeurs sélectionnées
    const species = selectSpecies.value;
    const island = selectIsland.value;
    const sex = selectSex.value;

    // Sélectionne la div où le graphique sera affiché
    const div = document.querySelector("#myplot");
 
    // Vide le contenu précédent de la div
    div.innerHTML = "";
 
    // Crée le graphique avec Plot
    const plot = Plot.plot({
      marks: [
        // Ajoute les points du graphique, filtrés selon tous les critères
        Plot.dot(penguins.filter(d => 
          (species === "" || d.species === species) &&
          (island === "" || d.island === island) &&
          (sex === "" || d.sex === sex)
        ), {
          x: "culmen_length_mm", // Axe X : longueur du bec
          y: "culmen_depth_mm", // Axe Y : profondeur du bec
          stroke: "species", // Couleur selon l'espèce
        }),
      ],
    });
    // Ajoute le graphique à la div
    div.appendChild(plot);
  }

  // Ajoute des écouteurs d'événement pour tous les selects
  selectSpecies.addEventListener("change", renderPlot);
  selectIsland.addEventListener("change", renderPlot);
  selectSex.addEventListener("change", renderPlot);

  // Affiche le graphique au chargement de la page
  renderPlot();

</script>

</Layout>